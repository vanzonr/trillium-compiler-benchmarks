#!/bin/bash
# file: setup-aocc-5

module --force purge
module use /opt/software/easybuild0/modules/all
module load aocc/5.0.0 AOCL-BLAS/5.0 GSL/2.8 rarray/2.8.0 Catch2/3.8.1 Boost/1.85.0 FFTW/3.3.10 OpenMPI/5.0.7-GCC-14.2.0-aocc

if [ $? = 0 ]; then
    
    cat > $(dirname ${BASH_SOURCE})/config.mk <<-EOF
	# file: config.mk
	# generated by: setup-aocc-5

	CC=clang
	CXX=clang++
	MPICXX=mpicxx 

	OPTFLAGS=-Ofast -ffast-math -march=native -flto -funroll-loops
	WARNFLAGS=-Wall -Wfatal-errors -Wno-unused-function

	CFLAGS=\$(OPTFLAGS) \$(WARNFLAGS) 
	CXXFLAGS=-std=c++17 \$(CFLAGS)
	OMPFLAGS=-fopenmp
	LDFLAGS=-O3

	CATCH2INCDIR=\$(EBROOTCATCH2)/include
	CATCH2LIBDIR=\$(EBROOTCATCH2)/lib
	CATCH2LIBS=-lCatch2Main -lCatch2

	BLASLIBS=-lblis-mt
	BLASINCDIR=\$(EBROOTAOCLMINBLAS)/include/blis
	BLASLIBDIR=\$(EBROOTAOCLMINBLAS)/lib
	#BLASLIBS=-lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread -lm -ldl

	BOOSTLIBS=-lboost_program_options

	GSLLIBS=-lgsl \${BLASLIBS}
	
	FFTWLIBS=-lfftw3
EOF
fi
