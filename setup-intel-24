#!/bin/bash
# file: setup-intel-24

module --force purge
module load CCconfig gentoo/2023
module load StdEnv/2023 intel/2024.2.0 rarray/2.8.0 catch2/3.8.1 boost/1.85.0 fftw/3.3.10 aocl-blas/5.1 gsl/2.7 openmpi/5.0.3 # imkl is slower

if [ $? = 0 ]; then
    
    cat > $(dirname ${BASH_SOURCE})/config.mk <<-EOF
	# file: config.mk
	# generated by: setup-intel-24

	CC=icx
	CXX=icpx
	MPICXX=mpicxx

	OPTFLAGS=-Ofast -march=skylake-avx512 -funroll-loops -ffast-math
	WARNFLAGS=-Wall -Wfatal-errors -Wno-nan-infinity-disabled

	CFLAGS=\$(OPTFLAGS) \$(WARNFLAGS)
	CXXFLAGS=-std=c++17 \$(CFLAGS)
	OMPFLAGS=-qopenmp
	LDFLAGS=-O3

	CATCH2INCDIR=\$(EBROOTCATCH2)/include
	CATCH2LIBDIR=\$(EBROOTCATCH2)/lib
	CATCH2LIBS=-lCatch2Main -lCatch2

	BLASLIBS=-lblis-mt64
	BLASINCDIR=\$(EBROOTAOCLMINBLAS)/include/blis64
	#BLASLIBS=-lmkl_intel_lp64 -lmkl_sequential -lmkl_core -lpthread -lm -ldl

	BOOSTLIBS=-lboost_program_options

	GSLLIBS=-lgsl \${BLASLIBS}
	
	FFTWLIBS=-lfftw3
EOF
fi
