#!/bin/bash
# file: setup-gcc-12

module --force purge
module load CCconfig gentoo/2023 
module load gcc/12.3 rarray/2.8.0 catch2/3.8.1 boost/1.85.0 aocl-blas/5.1 fftw/3.3.10 gsl/2.7 openmpi/4.1.5

if [ $? = 0 ]; then
    
    cat > $(dirname ${BASH_SOURCE})/config.mk <<-EOF
	# file: config.mk
	# generated by: setup-gcc-12

	CC=gcc
	CXX=g++
	MPICXX=mpicxx

	OPTFLAGS=-Ofast -march=native -flto -funroll-loops -ffast-math
	WARNFLAGS=-Wall -Wfatal-errors -Wno-unused-function

	CFLAGS=\$(OPTFLAGS) \$(WARNFLAGS)
	CXXFLAGS=-std=c++17 \$(CFLAGS)
	OMPFLAGS=-fopenmp
	LDFLAGS=-O3 -flto

	CATCH2INCDIR=\$(EBROOTCATCH2)/include
	CATCH2LIBDIR=\$(EBROOTCATCH2)/lib
	CATCH2LIBS=-lCatch2Main -lCatch2

	BLASINCDIR=\$(EBROOTAOCLMINBLAS)/include/blis64
	BLASLIBS=-lblis-mt64

	BOOSTLIBS=-lboost_program_options

	GSLLIBS=-lgsl \${BLASLIBS}

	FFTWLIBS=-lfftw3
EOF
fi
